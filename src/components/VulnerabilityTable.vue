<template>
  <section class="hero is-link">
    <div class="hero-body">
      <p class="title">Vulnerabilites</p>
    </div>
  </section>

  <div class="control" @change="updateSeverity(value)">
    <label class="radio">
      <input type="radio" name="severity" value="" v-model="severity" checked />
      No filter
    </label>
    <label class="radio">
      <input type="radio" name="severity" value="CRITICAL" v-model="severity" />
      Critical
    </label>
    <label class="radio">
      <input type="radio" name="severity" value="HIGH" v-model="severity" />
      High
    </label>
    <label class="radio">
      <input type="radio" name="severity" value="MEDIUM" v-model="severity" />
      Medium
    </label>
    <label class="radio">
      <input type="radio" name="severity" value="LOW" v-model="severity" />
      Low
    </label>
  </div>

  <table class="table">
    <a
      v-for="vuln in vulnerabilities"
      v-bind:href="'https://cve.mitre.org/cgi-bin/cvename.cgi?name=' + vuln.CVE"
      v-bind:key="vuln.CVE"
      style="cursor: pointer"
    >
      <div
        class="alternating"
        :class="{
          'low-severity': isLowSeverity(vuln),
          'medium-severity': isMediumSeverity(vuln),
          'high-severity': isHighSeverity(vuln),
          'critical-severity': isCriticalSeverity(vuln),
        }"
      >
        <tr>
          <th colspan="4">{{ vuln.CVE }}</th>
        </tr>
        <tr>
          <th>Base score</th>
          <th>Severity</th>
          <th>Exploitability score</th>
          <th>Impact score</th>
        </tr>
        <tr>
          <td>{{ vuln.score }}</td>
          <td>{{ vuln.severity }}</td>
          <td>{{ vuln.exploitability }}</td>
          <td>{{ vuln.impactScore }}</td>
        </tr>
        <tr>
          <td colspan="4">{{ vuln.description }}</td>
        </tr>
      </div>
    </a>
  </table>
</template>

<script>
import axios from "axios";
export default {
  name: "VulnerabilityTable",
  methods: {
    isLowSeverity(vulnerability) {
      return vulnerability.severity === "LOW" ? true : false;
    },
    isMediumSeverity(vulnerability) {
      return vulnerability.severity === "MEDIUM" ? true : false;
    },
    isHighSeverity(vulnerability) {
      return vulnerability.severity === "HIGH" ? true : false;
    },
    isCriticalSeverity(vulnerability) {
      return vulnerability.severity === "CRITICAL" ? true : false;
    },
    updateSeverity() {
      this.pullData(this.severity);
    },
    pullData(severity = null, limit = 50) {
      let parameters = {};
      if (severity == null) {
        parameters = { params: { _limit: limit } };
      } else {
        parameters = { params: { _limit: limit, _severity: severity } };
      }
      axios
        .get("http://localhost:3000", parameters)
        .then((res) => {
          console.log(res.data);
          this.vulnerabilities = res.data;
        })
        .catch((err) => {
          console.log(err);
        });
    },
  },
  data() {
    return {
      vulnerabilities: [],
      severity: "",
    };
  },
  mounted() {
    this.pullData();
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
h3 {
  margin: 40px 0 0;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}

.alternating:nth-child(even) {
  background: rgb(235, 235, 235) !important;
  color: black !important;
}
.alternating:nth-child(odd) {
  background: #fff !important;
  color: black !important;
}
.alternating:hover {
  background: #eee !important;
}
.low-severity {
  border-left: 3px solid rgb(7, 221, 7) !important;
}
.medium-severity {
  border-left: 3px solid rgb(220, 248, 58) !important;
}
.high-severity {
  border-left: 3px solid rgb(255, 187, 41) !important;
}
.critical-severity {
  border-left: 3px solid red !important;
}
</style>
